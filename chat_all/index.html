<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ãƒãƒ£ãƒƒãƒˆ | è«–æ–‡åˆ¶ä½œãƒšãƒ¼ã‚¸</title>

  <!-- ğŸ”¹ Networkãƒ¢ãƒ‹ã‚¿ãƒ¼ï¼ˆfetch + WebSocketå¯¾å¿œï¼‰ -->
  <script>
    window.addEventListener("DOMContentLoaded", () => {
      // === Networkãƒ¢ãƒ‹ã‚¿ãƒ¼é ˜åŸŸ ===
      const netBox = document.createElement("div");
      netBox.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        max-height: 180px;
        overflow-y: auto;
        background: rgba(0,0,0,0.85);
        color: #00ff99;
        font-family: monospace;
        font-size: 13px;
        padding: 5px 10px;
        z-index: 99999;
        white-space: nowrap;
        box-shadow: 0 2px 5px rgba(0,0,0,0.5);
      `;
      netBox.innerHTML = "ğŸ›° <b>Network Monitor</b><br>";
      document.body.appendChild(netBox);

      // === fetchç›£è¦– ===
      const originalFetch = window.fetch;
      window.fetch = async (...args) => {
        const url = args[0];
        const method = (args[1]?.method || "GET").toUpperCase();
        const time = new Date().toLocaleTimeString();

        const logLine = document.createElement("div");
        logLine.textContent = `[${time}] ${method} â†’ ${url}`;
        netBox.appendChild(logLine);
        netBox.scrollTop = netBox.scrollHeight;

        try {
          const response = await originalFetch(...args);
          return response;
        } catch (e) {
          const errLine = document.createElement("div");
          errLine.style.color = "#ff5555";
          errLine.textContent = `âœ— ${method} ${url} ï¼ˆé€šä¿¡å¤±æ•—ï¼‰`;
          netBox.appendChild(errLine);
          return Promise.reject(e);
        }
      };

      // === WebSocketç›£è¦– ===
      const OriginalWebSocket = window.WebSocket;
      window.WebSocket = function (...args) {
        const url = args[0];
        const time = new Date().toLocaleTimeString();
        const logLine = document.createElement("div");
        logLine.style.color = "#99ccff";
        logLine.textContent = `[${time}] ğŸ”Œ WebSocketæ¥ç¶š â†’ ${url}`;
        netBox.appendChild(logLine);
        netBox.scrollTop = netBox.scrollHeight;
        return new OriginalWebSocket(...args);
      };
    });
  </script>

  <!-- ğŸ”¹ CSS + JSã‚’ç¢ºå®Ÿã«èª­ã¿è¾¼ã‚€ -->
  <script>
    window.addEventListener("DOMContentLoaded", () => {
      const version = Math.floor(Math.random() * 1000000) + 1;

      // CSS
      const css = document.createElement("link");
      css.rel = "stylesheet";
      css.href = `style.css?v=${version}`;
      document.head.appendChild(css);

      // JSï¼ˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å¯¾å¿œã§ç¢ºå®Ÿã«å®Ÿè¡Œï¼‰
      const js = document.createElement("script");
      js.type = "module";
      js.src = `main.js?v=${version}`;
      document.body.appendChild(js);

      console.log("version:", version);
    });
  </script>
</head>

<body>
  <header>
    <h2><a href="../">ã€Š</a></h2><h1>ãƒãƒ£ãƒƒãƒˆ</h1>
  </header>

  <main id="chat-container">
    <!-- å„æŠ•ç¨¿ã¯JSã§ç”Ÿæˆ -->
  </main>

  <!-- é€ä¿¡å¸¯ -->
  <div class="chat-input-area">
    <button id="file-btn">ğŸ“‚</button>
    <textarea id="chat-input" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›..." rows="2"></textarea>
    <button id="send-btn">
      <img src="../imgs/chat/send.png" alt="é€ä¿¡">
    </button>
  </div>
</body>
</html>
